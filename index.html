<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CD Premium Player</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --bg: #0f0f0f;
            --accent: #007aff;
        }

        body {
            background: var(--bg);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
        }

        #loader { position: absolute; top: 50%; }

        /* –ü–æ–ª–∫–∞ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ */
        .swiper { width: 100%; max-height: 45vh; padding: 20px 0; }
        .swiper-slide { width: 280px; height: 280px; display: flex; justify-content: center; align-items: center; }

        /* –ö–æ–Ω–≤–µ—Ä—Ç –∏ –¥–∏—Å–∫ */
        .cd-case {
            width: 250px; height: 250px;
            position: relative;
            background: #1a1a1a; /* –¶–≤–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞ */
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            overflow: hidden;
        }

        .window-overlay {
            position: absolute;
            inset: 0;
            z-index: 3;
            background-image: url('window.png'); /* –¢–≤–æ—è —Ç–µ–∫—Å—Ç—É—Ä–∞ */
            background-size: cover;
            /* –ï—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ—Ç, –¥–µ–ª–∞–µ–º –¥—ã—Ä–∫—É –∫–æ–¥–æ–º */
            mask-image: radial-gradient(circle 75px at center, transparent 99%, black 100%);
            -webkit-mask-image: radial-gradient(circle 75px at center, transparent 99%, black 100%);
            pointer-events: none;
        }

        .disk {
            position: absolute;
            width: 240px; height: 240px;
            top: 5px; left: 5px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            z-index: 2;
        }

        /* –ó–æ–Ω–∞ –ø–ª–µ–µ—Ä–∞ (–∫—É–¥–∞ –ª–µ—Ç–∏—Ç –¥–∏—Å–∫) */
        .player-hub {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .drop-zone {
            width: 300px; height: 300px;
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 50%;
            position: relative;
        }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .ui-panel {
            padding-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .main-btn {
            padding: 15px 35px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: var(--accent);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,122,255,0.4);
        }

        .main-btn:disabled { background: #333; opacity: 0.5; cursor: not-allowed; }
        
        .speed-badge {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 15px;
            font-family: monospace;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
    </style>
</head>
<body>

    <div id="loader">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏...</div>

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="shelf"></div>
    </div>

    <div class="player-hub">
        <div class="drop-zone" id="target"></div>
    </div>

    <div class="ui-panel">
        <button id="actionBtn" class="main-btn" disabled>
            <span id="btnIcon">üíø</span>
            <span id="btnText">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å–∫</span>
        </button>
        <div id="speedUI" class="speed-badge">RPM: <span id="rpm">0</span></div>
    </div>

    <script>
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub (–ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ò)
        const user = 'cursorus'; 
        const repo = 'cd';
        
        const shelf = document.getElementById('shelf');
        const actionBtn = document.getElementById('actionBtn');
        const btnText = document.getElementById('btnText');
        const btnIcon = document.getElementById('btnIcon');
        const speedUI = document.getElementById('speedUI');
        const rpmText = document.getElementById('rpm');

        let selectedDisk = null;
        let spinAnim = null;
        let currentState = 'SELECT'; // SELECT -> INSERT -> PLAY -> STOP

        async function init() {
            try {
                const res = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/images`);
                const files = await res.json();
                const images = files.filter(f => f.name.match(/\.(png|jpg|webp)$/i));
                
                images.forEach(file => {
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.innerHTML = `
                        <div class="cd-case" onclick="handleSelect(this)">
                            <div class="window-overlay"></div>
                            <div class="disk" style="background-image: url('${file.download_url}')"></div>
                        </div>
                    `;
                    shelf.appendChild(slide);
                });

                new Swiper(".mySwiper", {
                    effect: "coverflow",
                    centeredSlides: true,
                    slidesPerView: "auto",
                    coverflowEffect: { rotate: 35, stretch: 0, depth: 160, modifier: 1, slideShadows: true }
                });
                document.getElementById('loader').style.display = 'none';
            } catch (e) {
                document.getElementById('loader').innerText = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API.";
            }
        }

        function handleSelect(caseEl) {
            if (currentState !== 'SELECT') return;
            
            selectedDisk = caseEl.querySelector('.disk');
            gsap.to(selectedDisk, { y: -180, duration: 0.5, ease: "back.out" });
            
            currentState = 'INSERT';
            updateBtn("üì•", "–í—Å—Ç–∞–≤–∏—Ç—å –¥–∏—Å–∫");
            actionBtn.disabled = false;
        }

        actionBtn.onclick = () => {
            if (currentState === 'INSERT') {
                const target = document.getElementById('target').getBoundingClientRect();
                const current = selectedDisk.getBoundingClientRect();

                gsap.to(selectedDisk, {
                    x: target.left - current.left + 30,
                    y: target.top - current.top + 30,
                    width: 240, height: 240,
                    duration: 1,
                    ease: "power2.inOut",
                    onComplete: () => {
                        currentState = 'PLAY';
                        updateBtn("‚ñ∂Ô∏è", "–ó–∞–ø—É—Å—Ç–∏—Ç—å");
                    }
                });
            } 
            else if (currentState === 'PLAY') {
                speedUI.style.display = 'block';
                spinAnim = gsap.to(selectedDisk, { 
                    rotation: 360, duration: 1.5, repeat: -1, ease: "none" 
                });
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ü–∏—Ñ—Ä RPM
                gsap.to({val: 0}, {
                    val: 33, duration: 2, 
                    onUpdate: function() { rpmText.innerText = Math.floor(this.targets()[0].val); }
                });

                currentState = 'STOP';
                updateBtn("‚èπÔ∏è", "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å");
            } 
            else if (currentState === 'STOP') {
                gsap.to(spinAnim, { 
                    timeScale: 0, duration: 4, ease: "power2.out",
                    onUpdate: () => {
                        rpmText.innerText = Math.floor(spinAnim.timeScale() * 33);
                    },
                    onComplete: () => {
                        spinAnim.pause();
                        actionBtn.disabled = true;
                        updateBtn("‚úÖ", "–ì–æ—Ç–æ–≤–æ");
                    }
                });
            }
        };

        function updateBtn(icon, text) {
            btnIcon.innerText = icon;
            btnText.innerText = text;
        }

        init();
    </script>
</body>
</html>
