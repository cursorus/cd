<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CD Shelf Auto-Loader</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        body { background: #1a1a1b; color: #eee; font-family: 'Segoe UI', sans-serif; height: 100vh; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        
        /* Стили полки */
        .swiper { width: 100%; padding: 50px 0; }
        .swiper-slide { width: 260px; height: 260px; display: flex; align-items: center; justify-content: center; }

        .cd-case { width: 240px; height: 240px; position: relative; cursor: pointer; transition: transform 0.3s; }
        .sleeve { 
            position: absolute; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #333, #111); 
            z-index: 2; border-radius: 4px; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
        }
        /* Дырка в конверте */
        .sleeve::after {
            content: ''; position: absolute; width: 100px; height: 100px;
            background: rgba(0,0,0,0.3); border-radius: 50%; border: 1px solid rgba(255,255,255,0.1);
        }

        .disk { 
            position: absolute; width: 230px; height: 230px; 
            border-radius: 50%; top: 5px; left: 5px; z-index: 1;
            background-size: cover; background-position: center;
            box-shadow: 0 0 15px rgba(0,0,0,0.6);
        }

        .controls { margin-top: 40px; display: flex; gap: 15px; }
        button { 
            padding: 12px 24px; border: none; background: #444; color: white; 
            border-radius: 20px; cursor: pointer; font-weight: bold; opacity: 0.3; pointer-events: none;
        }
        button.active { opacity: 1; pointer-events: all; background: #007aff; }
    </style>
</head>
<body>

    <div id="loader">Ищу диски в папке images...</div>

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="shelf"></div>
    </div>

    <div class="controls">
        <button id="playBtn">Запустить диск</button>
        <button id="stopBtn">Остановить</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        // === НАСТРОЙКИ ГИТХАБА ===
        const user = 'ТВОЙ_ЛОГИН_ГИТХАБ'; 
        const repo = 'НАЗВАНИЕ_РЕПОЗИТОРИЯ';
        const folder = 'images';

        const shelf = document.getElementById('shelf');
        let selectedDisk = null;
        let spinAnim = null;

        // Функция-шпион: идет в Гитхаб и спрашивает список файлов
        async function loadImages() {
            try {
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${folder}`);
                const files = await response.json();
                
                // Фильтруем только картинки
                const imageFiles = files.filter(file => 
                    file.name.match(/\.(png|jpg|jpeg|webp)$/i)
                );

                if (imageFiles.length === 0) {
                    document.getElementById('loader').innerText = "В папке images пусто :(";
                    return;
                }

                renderShelf(imageFiles);
                document.getElementById('loader').style.display = 'none';
            } catch (e) {
                console.error(e);
                document.getElementById('loader').innerText = "Ошибка API. Проверь ник и название репо.";
            }
        }

        function renderShelf(files) {
            files.forEach(file => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.innerHTML = `
                    <div class="cd-case">
                        <div class="sleeve"></div>
                        <div class="disk" style="background-image: url('${file.download_url}')"></div>
                    </div>
                `;
                slide.onclick = () => pickDisk(slide.querySelector('.disk'));
                shelf.appendChild(slide);
            });

            // Запуск карусели
            new Swiper(".mySwiper", {
                effect: "coverflow",
                centeredSlides: true,
                slidesPerView: "auto",
                coverflowEffect: { rotate: 30, stretch: 0, depth: 100, modifier: 1, slideShadows: true },
            });
        }

        function pickDisk(el) {
            if (selectedDisk) return;
            selectedDisk = el;
            gsap.to(el, { y: -160, zIndex: 10, duration: 0.5, ease: "power2.out" });
            document.getElementById('playBtn').classList.add('active');
        }

        document.getElementById('playBtn').onclick = function() {
            this.classList.remove('active');
            gsap.to(selectedDisk, { 
                y: 250, scale: 1.1, duration: 0.8, ease: "back.inOut(1)",
                onComplete: () => {
                    spinAnim = gsap.to(selectedDisk, { rotation: 360, duration: 2, repeat: -1, ease: "none" });
                    document.getElementById('stopBtn').classList.add('active');
                }
            });
        };

        document.getElementById('stopBtn').onclick = function() {
            this.classList.remove('active');
            gsap.to(spinAnim, { 
                timeScale: 0, duration: 4, ease: "power2.out",
                onComplete: () => { spinAnim.pause(); }
            });
        };

        loadImages();
    </script>
</body>
</html>
